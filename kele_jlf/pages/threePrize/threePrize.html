<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="x5-fullscreen" content="true">
	<meta name="full-screen" content="yes">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<title>可口可乐</title>
	<link rel="stylesheet" href="threePrize.css">
	<link rel="stylesheet" href="../../css/plugins/loading.css">
	<script type="text/javascript" src="../../js/plugins/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="../../js/plugins/jweixin-1.2.0.js"></script>
	<script type="text/javascript" src="../../js/plugins/md5.min.js"></script>
	<script type="text/javascript" src="../../js/plugins/vue.min.js"></script>
	<script type="text/javascript" src="../../js/plugins/hammer.min.js"></script>
	<script type="text/javascript" src="../../js/plugins/vue-touch.min.js"></script>
	<script type="text/javascript" src="../../js/plugins/jsencrypt.min.js"></script>
	<script type="text/javascript" src="../../js/zexUtility.js"></script>
	<script type="text/javascript" src="../../js/zexService.js"></script>
	<script type="text/javascript" src="../../js/wxConfig.js"></script>
	<script type="text/javascript" src="../../js/zexApis.js"></script>
	<link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">
	<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.1.3/weui.min.js"></script>
	<style>
		.act_huodong_wrap {
			width: 100%;
			margin: 0 auto;
			/*border: 1px solid #000;*/
			text-align: center;
		}

		.huodong_wrap {
			width: 100%;
			height: 100%;
			position: fixed;
			z-index: 101;
			display: -webkit-flex;
			align-items: center;
			-webkit-align-items: center;
			justify-content: center;
			-webkit-justify-content: center;
			flex-direction: column-reverse;
			-webkit-flex-direction: column-reverse;
		}

		.huodong_container {
			width: 90%;
			height: 70%;
		}

		.huodong_content {
			width: 100%;
			height: 100%;
			border-radius: .6rem;
		}

		.huodong_content_img {
			width: 85%;
			height: 70%;
			font-size: 1.4rem;
			-webkit-overflow-scrolling: touch;
			border-radius: .6rem;
			margin-left: 7.5%;
		}

		.huodong_button {
			z-index: 999;
			margin-top: -32%;
			width: 50%;
			margin-left: calc((100% - 50%)/2);
			padding-top: 10%;


		}

		.cuo_img {
			width: 10%;
			margin: auto;
		}

	</style>
</head>
</head>

<body id="container" class="page_bg">
	<div id="page_loading" class="page-loading">
		<div class="page-loading-control">
			<div class="rect1"></div>
			<div class="rect2"></div>
			<div class="rect3"></div>
			<div class="rect4"></div>
			<div class="rect5"></div>
		</div>
	</div>

	<div class="page_box">

		<img class="bg_img" v-bind:src="page_info.bg_pic_url">

		<div class="next_btn" @click="addCard">
			<img :src="page_info.btn_pic_url" alt="" />
		</div>
	</div>


	<div class="act_huodong_wrap" v-show="course_show">
		<div class="weui-mask" style="z-index: 100;"></div>
		<div class="huodong_wrap">
			<div class="huodong_container">
				<div class="huodong_content">
					<div class="huodong_content_img">

						<img src="../../images/zj/threeCG.png" alt="" v-if="is_success_show" />

						<img src="../../images/zj/threeSB.png" alt="" v-if="!is_success_show" />

						<img src="../../images/zj/threeButton3.png" class="huodong_button" @click="next()" :style="{ height:buttonHeight }">

					</div>

					<img src="../../images/cuo.png" alt="" v-touch:tap="next()" :style=" { paddingTop:cuoTop}" class="cuo_img" />
				</div>
			</div>
		</div>
	</div>


	</div>
</body>
<script>
	
	//	if (history && history.pushState) {
	//		history.pushState({
	//			title: document.title,
	//			url: location.href
	//		}, document.title, location.href);
	//	}
	//	//添加退弹事件
	//	window.addEventListener("popstate", function(e) {
	//		// alert("我监听到了浏览器的返回按钮事件啦1"); 
	//		location.href = 'rewardPrize.html'; //在这里指定其返回的地址
	//	});


	var urlParams = {
		'component_appid': zexUtil.GetQueryString('component_appid') || "",
		'appid': zexUtil.GetQueryString('appid'),
		'actId': zexUtil.GetQueryString('actId'),
		'brand_id': zexUtil.GetQueryString('brand_id'),
		'openid': zexUtil.GetQueryString('openid'),
		'coupon_stock_id': zexUtil.GetQueryString('coupon_stock_id')
	};

	var realOpenid = zexUtil.rsaDecrypt(urlParams.openid, zexUtil.getRsaClientPrivateKey());


	var container = new Vue({
		el: "#container",
		data: function() {
			return {
				loading: true,

				page_info: {
					//	receive_bg: "../../images/zj/sdjbg.jpg",
					//	wining_btn_img: "../../images//zj/ZJButton.png", // 按钮图
					//	not_wining_btn_img: "../../images/zj/threeButton2.png",
					//	prize_img: "",
				},

				base_info: {},
				actid: "", //  活动卡券id

				course_show: false,
				is_success_show: "",

				cardList: {},
				urlParams: {},
				buttonHeight: "",
				cuoTop: "",
			};
		},
		created: function() {

			var self = this;
			console.log(window.innerHeight)

			if (window.innerHeight >= 724) {

				this.buttonHeight = "20%";
				this.cuoTop = "";
			} else {

				this.buttonHeight = "26%";
				this.cuoTop = "15%";
			}

			this.loading = false;
				setTimeout(function() {
						$('#page_loading').css('display', 'none');
					}, 500);
				self.course_show = true;
						self.is_success_show = false;

			//			this.base_info = JSON.parse(window.sessionStorage.getItem("base_info")) || {};
			//			this.urlParams = JSON.parse(window.sessionStorage.getItem("urlParams")) || {};
//
//			var wxConfigParams = {
//				component_appid: urlParams.component_appid,
//				appid: urlParams.appid,
//				url: window.location.href,
//				type: "jsapi"
//			};
//			zexApis.httpWxCheck(wxConfigParams).done(function(resJson) {
//				console.log('wx.config resJson:' + JSON.stringify(resJson));
//				wx.config({ //微信权限验证
//					debug: false,
//					appId: wxConfigParams.appid,
//					timestamp: resJson.timestamp,
//					nonceStr: resJson.noncestr,
//					signature: resJson.signature,
//					jsApiList: ['hideOptionMenu', 'addCard', 'openCard']
//				});
//				wx.ready(function(res) {
//					wx.hideOptionMenu();
//					self.getPageInfoDetail();
//				});
//				wx.error(function(res) {
//					console.log("配置失败");
//				});
//			});

		},
		methods: {

			getPageInfoDetail: function() {
				var self = this;
				var reqParams = {
					coupon_stock_id: urlParams.coupon_stock_id
				};

				zexApis.getWxCouponH5actPageDetail(reqParams).done(function(response) {
					//成公关闭loading页面
					setTimeout(function() {
						$('#page_loading').css('display', 'none');
					}, 500);
					if (response.code == 200) {
						self.page_info = response.h5act_page;
					} else {
						self.alertInfo("提示", zexUtil.GetQueryString("actId") + " 活动不存在", "我知道了", true);
						return;
					}
					self.is_loading = false;

				});

			},

			addCard: function() {
				var self = this;


				var req = {
					appid: urlParams.appid,
					coupon_stock_id: urlParams.coupon_stock_id,
					brand_id: urlParams.brand_id,
					openid: realOpenid,
					timestamp: zexUtil.getTimestamp()
				}

				zexApis.sendCouponStock(req).done(function(resJson) {
					if (resJson.code == "200" || resJson.code == 200) {
						self.course_show = true;
						self.is_success_show = true;
					} else {
						self.course_show = true;
						self.is_success_show = false;
					}
				});
			},

			next: function() {
				wx.closeWindow();
			},

			// weUI Alert => clickBtn -> closeWindow()
			alertInfo: function(title, content, btnTxt, isCloseWindow) {
				weui.alert(content, {
					title: title,
					buttons: [{
						label: btnTxt,
						type: 'primary',
						onClick: (function() {
							if (isCloseWindow) {
								this.closeWindow()
							}
						}).bind(this)
					}]
				});
			},

			// wx SDK clickWindow
			closeWindow: function() {
				wx.closeWindow();
			},
		},
	});

</script>

</html>
